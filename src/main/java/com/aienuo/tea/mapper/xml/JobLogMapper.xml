<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aienuo.tea.mapper.JobLogMapper">

    <!-- 数据表名称 -->
    <sql id="table_name">
        SYS_JOB_LOG
    </sql>

    <!-- 数据分页 - 查询返回值 -->
    <resultMap id="pageQuery" type="com.aienuo.tea.model.vo.JobLogVO">
        <id column="ID" property="id" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="JOB_ID" property="jobId" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="HANDLER_NAME" property="handlerName" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="HANDLER_PARAM" property="handlerParam" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="EXECUTE_INDEX" property="executeIndex" javaType="java.lang.Integer" jdbcType="INTEGER"/>
        <result column="START_TIME" property="startTime" javaType="java.time.LocalDateTime" jdbcType="TIMESTAMP"/>
        <result column="END_TIME" property="endTime" javaType="java.time.LocalDateTime" jdbcType="TIMESTAMP"/>
        <result column="DURATION" property="duration" javaType="java.lang.Long" jdbcType="INTEGER"/>
        <result column="STATUS" property="status" javaType="com.aienuo.tea.common.enums.JobLogStatusEnum" jdbcType="INTEGER"/>
        <result column="RESULT" property="result" javaType="java.lang.String" jdbcType="VARCHAR"/>
    </resultMap>

    <!-- 分页查询 -->
    <select id="pagingQueryListByParameter" resultMap="pageQuery">
        SELECT
            ID, JOB_ID, HANDLER_NAME, HANDLER_PARAM, EXECUTE_INDEX, START_TIME, END_TIME, DURATION, STATUS, RESULT
        FROM
        <include refid="table_name"/>
        <where>
            <if test="param.id != null and param.id != '' ">
                AND id = #{param.id}
            </if>
            <if test="param.jobId != null and param.jobId != ''">
                AND JOB_ID = #{param.jobId}
            </if>
            <if test="param.handlerName != null and param.handlerName != '' ">
                <!-- Oracle 中只支持两个参数 使用bind来让SQL支持两个以上 -->
                <bind name="nameLike" value="'%' + param.handlerName + '%'"/>
                AND HANDLER_NAME LIKE #{nameLike}
            </if>
            <if test="param.handlerParam != null and param.handlerParam != '' ">
                <!-- Oracle 中只支持两个参数 使用bind来让SQL支持两个以上 -->
                <bind name="paramLike" value="'%' + param.handlerParam + '%'"/>
                AND HANDLER_PARAM LIKE #{paramLike}
            </if>
            <if test="param.startTime != null">
                AND START_TIME <![CDATA[<=]]> #{param.startTime}
            </if>
            <if test="param.endTime != null ">
                AND END_TIME <![CDATA[<=]]> #{param.endTime}
            </if>
            <if test="param.status != null and param.status != ''">
                AND STATUS = #{param.status}
            </if>
            <if test="param.result != null and param.result != '' ">
                <!-- Oracle 中只支持两个参数 使用bind来让SQL支持两个以上 -->
                <bind name="resultLike" value="'%' + param.result + '%'"/>
                AND RESULT LIKE #{resultLike}
            </if>

            <!-- 创建人 -->
            <if test="param.creatorBy != null and param.creatorBy != ''">
                AND creator_by = #{param.creatorBy}
            </if>
            <!-- 创建时间-起 -->
            <if test="param.createTimeStart != null">
                AND create_time <![CDATA[>=]]> #{param.createTimeStart}
            </if>
            <!-- 创建时间-止 -->
            <if test="param.createTimeEnd != null ">
                AND create_time <![CDATA[<=]]> #{param.createTimeEnd}
            </if>
            <!-- 更新人 -->
            <if test="param.updaterBy != null and param.updaterBy != ''">
                AND updater_by = #{param.updaterBy}
            </if>
            <!-- 更新时间-起 -->
            <if test="param.updateTimeStart != null">
                AND update_time <![CDATA[>=]]> #{param.updateTimeStart}
            </if>
            <!-- 更新时间-止 -->
            <if test="param.updateTimeEnd != null ">
                AND update_time <![CDATA[<=]]> #{param.updateTimeEnd}
            </if>
            <!-- 超级查询参数 这个参数方便自定义SQL条件查询（要考虑SQL注入，查询条件与数据权限冲突） -->
            <if test="param.superQueryParams != null and param.superQueryParams != ''">
                AND #{param.superQueryParams}
            </if>
        </where>
        ORDER BY
            CREATE_TIME DESC
    </select>

</mapper>
