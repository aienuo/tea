<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aienuo.tea.mapper.UserMapper">

    <!-- 数据表名称 -->
    <sql id="table_name">
        SYS_USER
    </sql>

    <!-- 数据分页 - 查询返回值 -->
    <resultMap id="pageQuery" type="com.aienuo.tea.model.vo.UserPageVO">
        <id column="ID" property="id" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="USERNAME" property="username" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="REAL_NAME" property="realName" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="IDENTITY_NUMBER" property="identityNumber" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="UNIT_ID" property="unitId" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="DEL_FLAG" property="delFlag" javaType="java.lang.Integer" jdbcType="TINYINT"/>
    </resultMap>

    <!-- 分页查询 -->
    <select id="pagingQueryListByParameter" resultMap="pageQuery">
        SELECT
            ID,
            USERNAME,
            REAL_NAME,
            IDENTITY_NUMBER,
            UNIT_ID,
            DEL_FLAG
        FROM
            <include refid="table_name"/>
        <where>
            <!-- 数据分析单位列表（当前单位标识及所有子级单位标识） -->
            <if test="param.unitIdList != null and !param.unitIdList.isEmpty()">
                AND UNIT_ID IN
                <foreach item="unitId" collection="param.unitIdList" open="(" separator="," close=")">
                    #{unitId}
                </foreach>
            </if>
            <if test="param.id != null and param.id != '' ">
                AND id = #{param.id}
            </if>
            <if test="param.username != null and param.username != '' ">
                <!-- Oracle 中只支持两个参数 使用bind来让SQL支持两个以上 -->
                <bind name="usernameLike" value="'%' + param.username + '%'"/>
                AND USERNAME LIKE #{usernameLike}
            </if>
            <if test="param.realName != null and param.realName != '' ">
                <!-- Oracle 中只支持两个参数 使用bind来让SQL支持两个以上 -->
                <bind name="realNameLike" value="'%' + param.realName + '%'"/>
                AND REAL_NAME LIKE #{realNameLike}
            </if>
            <if test="param.identityNumber != null and param.identityNumber != '' ">
                <!-- Oracle 中只支持两个参数 使用bind来让SQL支持两个以上 -->
                <bind name="identityNumberLike" value="'%' + param.identityNumber + '%'"/>
                AND IDENTITY_NUMBER LIKE #{identityNumberLike}
            </if>
            <if test="param.delFlag != null and param.delFlag != '' ">
                AND DEL_FLAG = #{param.delFlag}
            </if>

            <!-- 创建人 -->
            <if test="param.creatorBy != null and param.creatorBy != ''">
                AND creator_by = #{param.creatorBy}
            </if>
            <!-- 创建时间-起 -->
            <if test="param.createTimeStart != null">
                AND create_time <![CDATA[>=]]> #{param.createTimeStart}
            </if>
            <!-- 创建时间-止 -->
            <if test="param.createTimeEnd != null ">
                AND create_time <![CDATA[<=]]> #{param.createTimeEnd}
            </if>
            <!-- 更新人 -->
            <if test="param.updaterBy != null and param.updaterBy != ''">
                AND updater_by = #{param.updaterBy}
            </if>
            <!-- 更新时间-起 -->
            <if test="param.updateTimeStart != null">
                AND update_time <![CDATA[>=]]> #{param.updateTimeStart}
            </if>
            <!-- 更新时间-止 -->
            <if test="param.updateTimeEnd != null ">
                AND update_time <![CDATA[<=]]> #{param.updateTimeEnd}
            </if>
            <!-- 超级查询参数 这个参数方便自定义SQL条件查询（要考虑SQL注入，查询条件与数据权限冲突） -->
            <if test="param.superQueryParams != null and param.superQueryParams != ''">
                AND #{param.superQueryParams}
            </if>
        </where>
    </select>

</mapper>
