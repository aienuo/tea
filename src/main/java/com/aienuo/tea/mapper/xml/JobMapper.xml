<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aienuo.tea.mapper.JobMapper">

    <!-- 数据表名称 -->
    <sql id="table_name">
        SYS_JOB
    </sql>

    <!-- 数据分页 - 查询返回值 -->
    <resultMap id="pageQuery" type="com.aienuo.tea.model.vo.JobVO">
        <id column="ID" property="id" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="NAME" property="name" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="STATUS" property="status" javaType="com.aienuo.tea.common.enums.JobStatusEnum" jdbcType="INTEGER"/>
        <result column="HANDLER_NAME" property="handlerName" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="HANDLER_PARAM" property="handlerParam" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="CRON_EXPRESSION" property="cronExpression" javaType="java.lang.String" jdbcType="VARCHAR"/>
        <result column="RETRY_COUNT" property="retryCount" javaType="java.lang.Integer" jdbcType="INTEGER"/>
        <result column="RETRY_INTERVAL" property="retryInterval" javaType="java.lang.Integer" jdbcType="INTEGER"/>
        <result column="MONITOR_TIMEOUT" property="monitorTimeout" javaType="java.lang.Integer" jdbcType="INTEGER"/>
        <result column="CREATE_TIME" property="createTime" javaType="java.time.LocalDateTime" jdbcType="TIMESTAMP"/>
        <result column="UPDATE_TIME" property="updateTime" javaType="java.time.LocalDateTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 分页查询 -->
    <select id="pagingQueryListByParameter" resultMap="pageQuery">
        SELECT
            ID, NAME, STATUS, HANDLER_NAME, HANDLER_PARAM, CRON_EXPRESSION, RETRY_COUNT, RETRY_INTERVAL, MONITOR_TIMEOUT, CREATE_TIME, UPDATE_TIME
        FROM
        <include refid="table_name"/>
        <where>
            <if test="param.id != null and param.id != '' ">
                AND id = #{param.id}
            </if>
            <if test="param.name != null and param.name != '' ">
                <!-- Oracle 中只支持两个参数 使用bind来让SQL支持两个以上 -->
                <bind name="nameLike" value="'%' + param.name + '%'"/>
                AND NAME LIKE #{nameLike}
            </if>
            <if test="param.status != null and param.status != ''">
                AND STATUS = #{param.status}
            </if>
            <if test="param.handlerName != null and param.handlerName != '' ">
                <!-- Oracle 中只支持两个参数 使用bind来让SQL支持两个以上 -->
                <bind name="handlerNameLike" value="'%' + param.handlerName + '%'"/>
                AND HANDLER_NAME LIKE #{handlerNameLike}
            </if>
            <if test="param.handlerParam != null and param.handlerParam != '' ">
                <!-- Oracle 中只支持两个参数 使用bind来让SQL支持两个以上 -->
                <bind name="paramLike" value="'%' + param.handlerParam + '%'"/>
                AND HANDLER_PARAM LIKE #{paramLike}
            </if>
            <if test="param.cronExpression != null and param.cronExpression != '' ">
                <!-- Oracle 中只支持两个参数 使用bind来让SQL支持两个以上 -->
                <bind name="cronExpressionLike" value="'%' + param.cronExpression + '%'"/>
                AND CRON_EXPRESSION LIKE #{cronExpressionLike}
            </if>

            <!-- 创建人 -->
            <if test="param.creatorBy != null and param.creatorBy != ''">
                AND creator_by = #{param.creatorBy}
            </if>
            <!-- 创建时间-起 -->
            <if test="param.createTimeStart != null">
                AND create_time <![CDATA[>=]]> #{param.createTimeStart}
            </if>
            <!-- 创建时间-止 -->
            <if test="param.createTimeEnd != null ">
                AND create_time <![CDATA[<=]]> #{param.createTimeEnd}
            </if>
            <!-- 更新人 -->
            <if test="param.updaterBy != null and param.updaterBy != ''">
                AND updater_by = #{param.updaterBy}
            </if>
            <!-- 更新时间-起 -->
            <if test="param.updateTimeStart != null">
                AND update_time <![CDATA[>=]]> #{param.updateTimeStart}
            </if>
            <!-- 更新时间-止 -->
            <if test="param.updateTimeEnd != null ">
                AND update_time <![CDATA[<=]]> #{param.updateTimeEnd}
            </if>
            <!-- 超级查询参数 这个参数方便自定义SQL条件查询（要考虑SQL注入，查询条件与数据权限冲突） -->
            <if test="param.superQueryParams != null and param.superQueryParams != ''">
                AND #{param.superQueryParams}
            </if>
        </where>
    </select>

</mapper>
